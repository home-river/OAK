存放了每日的开发记录

## 2025-11-03

**验证器的实现**

验证器的实现应该先统一调用各个DTO字段内部的验证逻辑，然后再实现各个DTO之间的验证逻辑。所以第一步是重新梳理各个DTO的验证逻辑，并实现验证器的实现。

TODO：
- [ √ ] 重新梳理各个DTO的验证逻辑，并补全内部验证。
- [ √ ] 实现验证器的额外校验逻辑。
- [ √ ] 实现验证器的统一入口。


### 2025-11-04

完善了配置DTO内部的验证逻辑，现在可以对顶层DTO调用验证接口，快速进行DTO内部自检，下一步可以开始实现验证器的额外校验逻辑。
也就是对DTO之间的验证逻辑，比如角色绑定和设备元数据的一致性检查。

### 2025-11-05
完成了验证器的实现。



## 2025-11-05
**配置管理器的实现**

### 2025-11-06
基本完成了样板DTO工具的实现，为配置管理器创建默认配置和配置参数的硬编码管理提供了支持。

**注**：实现样板工具是因为直接管理JSON配置太过于困难，样板工具可以方便的创建默认配置和配置参数的硬编码管理。
后续开发CLI工具或者可视化管理工具后，再迁移重心到JSON配置。

下一步，继续完善配置管理器。



### 2025-11-07

**配置管理器已实现接口**

1. __init__(config_path=None, auto_create=True, eager_load=False, include_runtime_checks=False)
   初始化配置管理器并设置路径/内部状态，可选构造期加载。

2. load_config(validate=True, config_path=None, auto_create=None) -> bool
   从 JSON 读取为 `DeviceManagerConfigDTO`，可自动创建默认配置并做结构校验。

3. save_config() -> bool
   将当前“可运行配置”原子写盘并更新时间戳。

4. get_config() -> DeviceManagerConfigDTO
   获取当前“草稿配置”（未加载则抛错）。

5. get_runnable_config() -> DeviceManagerConfigDTO
   获取当前“可运行配置”（不存在则抛错）。

6. create_and_set_default_config() -> bool
   设备发现→创建默认配置→内部匹配，设置草稿=可运行配置并记录匹配结果。

7. promote_runnable_if_valid(include_runtime_checks=True, persist=False) -> DeviceManagerConfigDTO
   校验草稿通过后晋升为“可运行配置”，可选立即持久化。

8. restore_runnable_config() -> DeviceManagerConfigDTO
   将草稿回滚为最近一次“可运行配置”快照。

9. _match_config_internal(config, online_devices, ..., require_at_least_one_binding=True) -> (DeviceManagerConfigDTO, DeviceMatchResult)
   使用 `DeviceMatchManager` 执行匹配/自动绑定并导出新配置，可选做全量/运行态校验。

10. get_default_config() -> DeviceManagerConfigDTO
   创建并返回的默认配置（工厂方法）：根据设备列表创建未绑定的原生配置，后续需进行绑定


### 2025-11-08

**配置管理器新增已实现接口**

1. get_last_match_result() -> Optional[DeviceMatchResult]
   获取最近一次设备匹配的结果（只读）。

2. is_dirty() -> bool
   检查当前“草稿配置”是否领先于“可运行配置”。

3. has_runnable_config() -> bool
   检查是否存在“可运行配置”。

4. validate_config(include_runtime_checks=False) -> (bool, List[str])
   统一入口执行结构/跨字段校验，可选启用运行态校验。

5. get_oak_module_config() -> OAKModuleConfigDTO
   获取 OAK 模块配置（从“可运行配置”导出）。

6. get_data_processing_config() -> DataProcessingConfigDTO
   获取数据处理模块配置（从“可运行配置”导出）。

7. get_can_config() -> CANConfigDTO
   获取 CAN 模块配置（从“可运行配置”导出）。

8. get_display_config() -> DisplayConfigDTO
   获取显示模块配置（从“可运行配置”导出）。

9. get_system_config() -> SystemConfigDTO
   获取系统模块配置（从“可运行配置”导出）。


## 2025-11-09~2025-11-15

确认了事件模块的实现方案，并实现了事件模块的样板代码。
对各个模块开始增加日志处理功能。
完成了系统异常日志捕捉的钩子函数，线程日志异常捕捉的钩子函数。


## 2025-11-17~2025-11-23
- 11-17
设备匹配器日志功能补全完毕。
日志配置从零散配置改为统一入口处进行配置。

- 11-18
日志统一配置函数`configure_logging`完成。
`SystemConfigDTO`字段补充了timed rotating file handler的配置字段，支持按时间滚动和按大小滚动两种模式切换

