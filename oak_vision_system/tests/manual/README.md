# 手动测试脚本

本目录包含需要人工交互的手动测试脚本。

## Ctrl+C 捕获测试

### 文件
- `manual_test_ctrl_c.py` - 测试SystemManager的Ctrl+C信号捕获和优雅关闭功能

### 运行方式

```bash
# 从项目根目录运行
python oak_vision_system/tests/manual/manual_test_ctrl_c.py
```

### 测试步骤

1. **启动脚本**
   ```bash
   python oak_vision_system/tests/manual/manual_test_ctrl_c.py
   ```

2. **观察启动过程**
   - 系统会创建SystemManager
   - 注册4个测试模块（数据采集器、数据处理器、显示模块、输出模块）
   - 按优先级启动所有模块

3. **按Ctrl+C**
   - 看到"等待信号中..."提示后
   - 按下 `Ctrl+C`

4. **观察关闭过程**
   - 应该看到"接收到SIGINT信号"日志
   - 模块按优先级从低到高关闭（上游→下游）
   - 最后显示"系统已优雅关闭"

### 预期输出示例

```
======================================================================
SystemManager Ctrl+C 捕获测试
======================================================================

步骤 1: 创建SystemManager
----------------------------------------------------------------------
✓ SystemManager创建成功

步骤 2: 注册测试模块
----------------------------------------------------------------------
  ✓ [数据采集器] 启动
  ✓ [数据处理器] 启动
  ✓ [显示模块] 启动
  ✓ [输出模块] 启动
✓ 4个模块注册成功

步骤 3: 启动所有模块（按优先级从高到低）
----------------------------------------------------------------------
✓ 所有模块启动成功

步骤 4: 当前系统状态
----------------------------------------------------------------------
  - 数据采集器: running
  - 数据处理器: running
  - 显示模块: running
  - 输出模块: running

======================================================================
系统运行中 - 请按 Ctrl+C 测试优雅关闭
======================================================================

等待信号中...

^C  ← 用户按Ctrl+C

接收到SIGINT信号 (Ctrl+C), 开始优雅关闭...
  ✓ [数据采集器] 停止
  ✓ [数据处理器] 停止
  ✓ [显示模块] 停止
  ✓ [输出模块] 停止

======================================================================
✅ 系统已优雅关闭
======================================================================

最终模块状态：
  ✓ 数据采集器: stopped
  ✓ 数据处理器: stopped
  ✓ 显示模块: stopped
  ✓ 输出模块: stopped

测试完成！
✅ 所有模块已正确停止
```

### 验证要点

✅ **信号捕获**：看到"接收到SIGINT信号"日志  
✅ **模块关闭顺序**：从低优先级到高优先级（上游→下游）  
✅ **优雅关闭**：所有模块状态变为"stopped"  
✅ **无异常退出**：程序正常结束，退出码为0  

### 故障排查

如果看到以下情况，说明可能有问题：

❌ **看到"捕获到KeyboardInterrupt异常"**
   - 说明信号处理器没有完全接管Ctrl+C
   - 检查signal.signal()是否正确注册

❌ **程序直接退出，没有关闭日志**
   - 说明信号处理器未被调用
   - 检查信号处理器是否被其他代码覆盖

❌ **部分模块未停止**
   - 说明关闭流程有问题
   - 检查shutdown()方法的实现

### 其他测试

可以尝试以下变体：

1. **测试SIGTERM**（仅Linux/Mac）
   ```bash
   # 在另一个终端找到进程ID
   ps aux | grep manual_test_ctrl_c
   
   # 发送SIGTERM信号
   kill -TERM <pid>
   ```

2. **测试多次Ctrl+C**
   - 快速按多次Ctrl+C
   - 验证系统只关闭一次（幂等性）

3. **测试关闭超时**
   - 修改DummyModule的stop()方法，添加time.sleep()
   - 验证超时处理是否正常

## 注意事项

- 这些测试需要人工操作，不能自动化运行
- 适合开发时快速验证功能
- 适合演示给其他开发者
- 不适合CI/CD流程
